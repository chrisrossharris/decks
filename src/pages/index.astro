---
import AppLayout from '@/layouts/AppLayout.astro';
import { listProjects } from '@/lib/db/repo';
import QuickStartPanel from '@/components/QuickStartPanel.astro';

const userId = Astro.locals.auth().userId;
const projects = userId ? await listProjects(userId) : [];
---

<AppLayout title="Takeoff + Estimate Engine">
  <section class="grid gap-4 lg:grid-cols-3">
    <article class="card p-5 lg:col-span-2">
      <p class="mb-2 text-xs font-semibold uppercase tracking-[0.2em] text-pine">MVP Scope</p>
      <h2 class="font-display text-2xl font-bold">DeckTakeoffPro</h2>
      <p class="mt-2 text-sm text-slate-600">
        Rules-based takeoffs, labor planning, margin clarity, and PDF exports.
      </p>
      <div class="mt-4 flex flex-wrap gap-2">
        <a href="/projects/new" class="rounded-md bg-pine px-4 py-2 text-sm font-semibold text-white">Create Project</a>
        <a href="/projects" class="rounded-md border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-700">View Projects</a>
      </div>
    </article>
    <article class="card p-5">
      <p class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-500">Flow</p>
      <ol class="mt-2 space-y-1 text-sm text-slate-700">
        <li>1. Create project</li>
        <li>2. Enter design inputs</li>
        <li>3. Generate versioned takeoff</li>
        <li>4. Edit items + pricing</li>
        <li>5. Generate labor + estimate</li>
        <li>6. Export PDFs</li>
      </ol>
    </article>
  </section>

  <section class="mt-5 card p-5">
    <div class="mb-3 flex items-center justify-between">
      <h3 class="font-display text-xl font-semibold">Recent Projects</h3>
      <a href="/projects/new" class="text-sm font-semibold text-pine underline">New Project</a>
    </div>
    {projects.length === 0 ? (
      <div class="rounded-lg border border-dashed border-slate-300 bg-slate-50 p-6 text-sm text-slate-600">
        No projects in this account yet. Seed data was created under `SEED_USER_ID` and may not appear in your Clerk user.
      </div>
    ) : (
      <div class="grid gap-3">
        {projects.slice(0, 5).map((project) => (
          <a href={`/projects/${project.id}/inputs`} class="rounded-lg border border-slate-200 bg-white p-3 hover:border-pine">
            <p class="font-semibold">{project.name}</p>
            <p class="text-xs text-slate-500">{project.type} â€¢ {project.status}</p>
          </a>
        ))}
      </div>
    )}
  </section>

  <div class="mt-5">
    <QuickStartPanel />
  </div>
</AppLayout>
